# 新增功能

迁移到 <span style="font-kerning:none">sometroublemaker.TV</span> 后，新增的功能有（包括但不限于）：

### 放映厅

- 新增 mpegts.js 播放器，用于播放直播服务器的 HTTP-TS 或 HTTP-FLV 流（默认不启用）。
- 直播视频自动重载（断开连接超过 15 秒后自动重连）。
- 新增手动重载视频按钮。
- 遇到浏览器不允许声音自动播放的情况，改为静音开播（而不是暂停）。
- 切换到其他页面时调用浏览器画中画功能（默认不启用）。
- 默认不再使用浏览器自带的 video controls，改为自定义播放器 UI。
- 全屏状态下 5 秒不操作，则自动隐藏播放器 UI。
- 新增“播放器信息”功能，可以查看当前视频播放器的各项参数（如播放器类型、视频分辨率、码率等）。
- 支持显示和发送弹幕（借助 danmaku.js）。
- 优先从 api.wzq02.top 获取直播视频流地址和标题。

### 聊天室

- UI 组件和接受消息的组件拆分。
- 聊天室内容支持 Markdown 语法（借助 marked.js）。
- 完善聊天室 UI，用户名和消息内容分开显示，并针对一些特殊 HTML 标签指定样式（包括 ```<img>```、```<code>```等）。
- 使用不同颜色和对齐位置区分自己和他人的留言。
- 可以查看历史消息记录。
- 可选不显示用户进入退出状态。
- 聊天室引入心跳包机制，避免反复重连。
- 借助 DOMPurify，在前端清理聊天室内容，防止 XSS 攻击（虽然好像没什么必要...）。
- 支持发送多行（如有需要建议将文本编辑完后粘贴到输入框，再回车发送）。
- 支持发送图片（实验性，需在 URL 中添加 ```?preconfig=allow_pic_upload:::1``` 以启用）。

### 其他

- 引入顶部导航栏用于路由切换，导航栏失去焦点时自动收起。
- 放映厅和聊天室 UI 完全重做，尽可能和主站（wzq02.top）样式保持一致。
- 提示内容以 toasts 方式呈现，而不是 JS ```alert()```。
- 支持中文和英语两种显示语言。
- 新增了设置面板，以调整本应用的各种行为。
- 针对移动设备调整 UI 布局（响应式设计）。
- 针对触屏设备优化操作逻辑（借助 Hammer.js）。
- 预配置功能，可以在 URL 中添加 ```?preconfig``` 参数对本应用进行预配置。
- 允许自定义聊天室和放映厅的后端服务器地址，以便于调试。
- 路由切换时显示加载条。